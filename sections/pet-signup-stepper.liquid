
<script
  src="{{ 'pet-signup-stepper.js' | asset_url }}"
  type="module"
  defer
></script>

<style>
  #shopify-section-{{ section.id }} {
    .pet-type-selection__title {
      /* font-size: 2rem; */
    }
    .pet-type-selection__subtitle {
      font-size: 1.2rem;
    }
  }
  #shopify-section-{{ section.id }} .pet-type-card__description {
    margin-bottom: 10px;
    font-size: 1rem;
  }
  #shopify-section-{{ section.id }} .pet-type-selection__title{
    font-size: 2rem;
  }
  
</style>

<div class="section-background color-{{ section.settings.color_scheme }}"></div>
<div class="section page-width-content color-{{ section.settings.color_scheme }}">
  <div
    class="pet-signup-stepper-wrapper spacing-style"
    style="
      {% render 'spacing-style', settings: section.settings %}
    "
  >
    <pet-signup-stepper
      class="pet-signup-stepper"
      section-id="{{ section.id }}"
      customer-logged-in="{% if customer %}true{% else %}false{% endif %}"
      customer-id="{% if customer %}{{ customer.id }}{% endif %}"
    >
      <!-- Initial Pet Type Selection -->
      <div class="pet-type-selection" ref="petTypeSelection">
        <div class="pet-type-selection__header">
          <h2 class="pet-type-selection__title">{{ section.settings.main_title }}</h2>
          <p class="pet-type-selection__subtitle">{{ section.settings.main_subtitle }}</p>
        </div>
        <div class="pet-type-selection__cards">
          <button
            class="pet-type-card"
            data-pet-type="dog"
            ref="dogCard"
            aria-label="Select Dog"
          >
            <div class="pet-type-card__image-wrapper">
              {% if section.settings.dog_image %}
                <img
                  src="{{ section.settings.dog_image | image_url: width: 600 }}"
                  alt="Dog"
                  class="pet-type-card__image"
                  loading="lazy"
                  width="600"
                  height="600"
                >
              {% else %}
                <div class="pet-type-card__placeholder">
                  <span class="pet-type-card__icon">üêï</span>
                </div>
              {% endif %}
            </div>
            <h3 class="pet-type-card__title">{{ section.settings.dog_title }}</h3>
            <p class="pet-type-card__description">{{ section.settings.dog_description }}</p>
          </button>

          <button
            class="pet-type-card"
            data-pet-type="cat"
            ref="catCard"
            aria-label="Select Cat"
          >
            <div class="pet-type-card__image-wrapper">
              {% if section.settings.cat_image %}
                <img
                  src="{{ section.settings.cat_image | image_url: width: 600 }}"
                  alt="Cat"
                  class="pet-type-card__image"
                  loading="lazy"
                  width="600"
                  height="600"
                >
              {% else %}
                <div class="pet-type-card__placeholder">
                  <span class="pet-type-card__icon">üê±</span>
                </div>
              {% endif %}
            </div>
            <h3 class="pet-type-card__title">{{ section.settings.cat_title }}</h3>
            <p class="pet-type-card__description">{{ section.settings.cat_description }}</p>
          </button>
        </div>
      </div>

      <!-- Stepper Form -->
      <div class="stepper-form" ref="stepperForm" hidden>
        <!-- Progress Indicator -->
        <div class="stepper-progress" ref="stepperProgress">
          <div class="stepper-progress__bar">
            <div class="stepper-progress__fill" ref="progressFill"></div>
          </div>
          <p class="stepper-progress__text" ref="progressText">Step 1 of 7</p>
        </div>

        <!-- Success Message -->
        <div class="stepper-form__success" ref="successMessage" hidden>
          {{- 'icon-checkmark.svg' | inline_asset_content -}}
          <span>{{ section.settings.success_message }}</span>
        </div>

        <!-- Error Message -->
        <div class="stepper-form__error" ref="errorMessage" hidden>
          {{- 'icon-error.svg' | inline_asset_content -}}
          <span ref="errorText"></span>
        </div>

        <form class="stepper-form__form" ref="form">
          <!-- Step 1: Pet Name -->
          <div class="form-step" data-step="1" ref="step[]">
            <h3 class="form-step__title">{{ section.settings.name_question }}</h3>
            <p class="form-step__help">{{ section.settings.name_help }}</p>
            <input
              type="text"
              name="pet_name"
              class="form-field__input"
              placeholder="Enter your pet's name"
              ref="petNameInput"
            >
          </div>

          <!-- Step 2: Birthday -->
          <div class="form-step" data-step="2" ref="step[]" hidden>
            <h3 class="form-step__title" ref="birthdayTitle">{{ section.settings.birthday_question }}</h3>
            <p class="form-step__help">{{ section.settings.birthday_help }}</p>
            <input
              type="date"
              name="pet_birthday"
              class="form-field__input"
            >
          </div>

          <!-- Step 3: Breed -->
          <div class="form-step" data-step="3" ref="step[]" hidden>
            <h3 class="form-step__title" ref="breedTitle">{{ section.settings.breed_question }}</h3>
            <p class="form-step__help">{{ section.settings.breed_help }}</p>
            <input
              type="text"
              name="pet_breed"
              class="form-field__input"
              placeholder="e.g., Golden Retriever, Tabby, etc."
            >
          </div>

          <!-- Step 4: Weight -->
          <div class="form-step" data-step="4" ref="step[]" hidden>
            <h3 class="form-step__title" ref="weightTitle">{{ section.settings.weight_question }}</h3>
            <div class="form-field__radio-group form-field__radio-group--weight" ref="dogWeightOptions">
              <label class="radio-card radio-card--weight">
                <input type="radio" name="pet_weight" value="tiny">
                <span class="radio-card__content">
                  <span class="radio-card__title">Tiny but mighty</span>
                  <span class="radio-card__subtitle">&lt;10lbs</span>
                </span>
              </label>
              <label class="radio-card radio-card--weight">
                <input type="radio" name="pet_weight" value="medium">
                <span class="radio-card__content">
                  <span class="radio-card__title">Perfect medium</span>
                  <span class="radio-card__subtitle">25-50lbs</span>
                </span>
              </label>
              <label class="radio-card radio-card--weight">
                <input type="radio" name="pet_weight" value="large">
                <span class="radio-card__content">
                  <span class="radio-card__title">Large and in charge</span>
                  <span class="radio-card__subtitle">50+lbs</span>
                </span>
              </label>
            </div>
            <div class="form-field__radio-group form-field__radio-group--weight" ref="catWeightOptions" hidden>
              <label class="radio-card radio-card--weight">
                <input type="radio" name="pet_weight" value="cat">
                <span class="radio-card__content">
                  <span class="radio-card__title">One size fits all</span>
                  <span class="radio-card__subtitle">Standard cat size</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Step 5: Allergies -->
          <div class="form-step" data-step="5" ref="step[]" hidden>
            <h3 class="form-step__title" ref="allergiesTitle">{{ section.settings.allergies_question }}</h3>
            <p class="form-step__help">Select all that apply</p>
            <div class="form-field__checkbox-group">
              <label class="checkbox-card">
                <input type="checkbox" name="allergies" value="beef">
                <span class="checkbox-card__content">
                  <span class="checkbox-card__icon">ü•©</span>
                  <span class="checkbox-card__label">Beef</span>
                </span>
              </label>
              <label class="checkbox-card">
                <input type="checkbox" name="allergies" value="chicken">
                <span class="checkbox-card__content">
                  <span class="checkbox-card__icon">üçó</span>
                  <span class="checkbox-card__label">Chicken</span>
                </span>
              </label>
              <label class="checkbox-card">
                <input type="checkbox" name="allergies" value="lamb">
                <span class="checkbox-card__content">
                  <span class="checkbox-card__icon">üêë</span>
                  <span class="checkbox-card__label">Lamb</span>
                </span>
              </label>
              <label class="checkbox-card">
                <input type="checkbox" name="allergies" value="turkey">
                <span class="checkbox-card__content">
                  <span class="checkbox-card__icon">ü¶É</span>
                  <span class="checkbox-card__label">Turkey</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Step 6: Health Boost -->
          <div class="form-step" data-step="6" ref="step[]" hidden>
            <h3 class="form-step__title" ref="boostTitle">{{ section.settings.boost_question }}</h3>
            <div class="form-field__radio-group form-field__radio-group--boost">
              <label class="radio-card radio-card--boost">
                <input type="radio" name="health_boost" value="joint_support">
                <span class="radio-card__content">
                  <span class="radio-card__icon">ü¶¥</span>
                  <span class="radio-card__label">Joint support</span>
                </span>
              </label>
              <label class="radio-card radio-card--boost">
                <input type="radio" name="health_boost" value="gut_health">
                <span class="radio-card__content">
                  <span class="radio-card__icon">üåü</span>
                  <span class="radio-card__label">Gut health</span>
                </span>
              </label>
              <label class="radio-card radio-card--boost">
                <input type="radio" name="health_boost" value="probiotic">
                <span class="radio-card__content">
                  <span class="radio-card__icon">üíö</span>
                  <span class="radio-card__label">Pre + pro biotic</span>
                </span>
              </label>
            </div>
          </div>

          <!-- Step 7: Review -->
          <div class="form-step form-step--review" data-step="7" ref="step[]" hidden>
            <h3 class="form-step__title" ref="reviewTitle">{{ section.settings.review_title }}</h3>
            <p class="form-step__help">{{ section.settings.review_subtitle }}</p>
            <div class="review-summary" ref="reviewSummary"></div>
          </div>

          <!-- Navigation Buttons -->
          <div class="stepper-navigation">
            <button type="button" class="button button--secondary" ref="backButton" hidden>
              Back
            </button>
            <button type="button" class="button button--primary" ref="nextButton">
              Next
            </button>
            <button type="submit" class="button button--primary" ref="submitButton" hidden>
              {{ section.settings.submit_button_text }}
            </button>
          </div>
        </form>
      </div>
    </pet-signup-stepper>
  </div>
</div>

{% schema %}
{
  "name": "Pet Signup Stepper",
  "class": "section-wrapper",
  "settings": [
    {
      "type": "header",
      "content": "Initial Selection"
    },
    {
      "type": "text",
      "id": "main_title",
      "label": "Main Title",
      "default": "Tell Us About Your Furry Friend!"
    },
    {
      "type": "textarea",
      "id": "main_subtitle",
      "label": "Main Subtitle",
      "default": "Choose your pet type to get started with a personalized subscription box"
    },
    {
      "type": "image_picker",
      "id": "dog_image",
      "label": "Dog Image"
    },
    {
      "type": "text",
      "id": "dog_title",
      "label": "Dog Card Title",
      "default": "I have a Dog"
    },
    {
      "type": "textarea",
      "id": "dog_description",
      "label": "Dog Card Description",
      "default": "Create a custom box for your canine companion"
    },
    {
      "type": "image_picker",
      "id": "cat_image",
      "label": "Cat Image"
    },
    {
      "type": "text",
      "id": "cat_title",
      "label": "Cat Card Title",
      "default": "I have a Cat"
    },
    {
      "type": "textarea",
      "id": "cat_description",
      "label": "Cat Card Description",
      "default": "Create a custom box for your feline friend"
    },
    {
      "type": "header",
      "content": "Form Questions"
    },
    {
      "type": "text",
      "id": "name_question",
      "label": "Pet Name Question",
      "default": "What's your pet's name?"
    },
    {
      "type": "text",
      "id": "name_help",
      "label": "Pet Name Help Text",
      "default": "We'll make sure all their goodies are labeled just for them!"
    },
    {
      "type": "text",
      "id": "birthday_question",
      "label": "Birthday Question",
      "default": "When's [pet_name]'s birthday?"
    },
    {
      "type": "text",
      "id": "birthday_help",
      "label": "Birthday Help Text",
      "default": "We love sending birthday surprises!"
    },
    {
      "type": "text",
      "id": "breed_question",
      "label": "Breed Question",
      "default": "What breed is [pet_name]?"
    },
    {
      "type": "text",
      "id": "breed_help",
      "label": "Breed Help Text",
      "default": "This helps us customize their box even better"
    },
    {
      "type": "text",
      "id": "weight_question",
      "label": "Weight Question",
      "default": "How much does [pet_name] weigh?"
    },
    {
      "type": "text",
      "id": "allergies_question",
      "label": "Allergies Question",
      "default": "Does [pet_name] have any protein allergies?"
    },
    {
      "type": "text",
      "id": "boost_question",
      "label": "Health Boost Question",
      "default": "What kind of boost does [pet_name] need most?"
    },
    {
      "type": "text",
      "id": "review_title",
      "label": "Review Step Title",
      "default": "Almost done! Let's review [pet_name]'s profile"
    },
    {
      "type": "text",
      "id": "review_subtitle",
      "label": "Review Step Subtitle",
      "default": "Make sure everything looks good before we create the profile"
    },
    {
      "type": "header",
      "content": "Form Settings"
    },
    {
      "type": "text",
      "id": "submit_button_text",
      "label": "Submit Button Text",
      "default": "Create Pet Profile"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success Message",
      "default": "Pet profile created successfully!"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color Scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 60
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 60
    }
  ],
  "presets": [
    {
      "name": "Pet Signup Stepper",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% stylesheet %}
  .pet-signup-stepper-wrapper {
    max-width: 1200px;
    margin: 0 auto;
  }

  /* Pet Type Selection */
  .pet-type-selection {
    display: flex;
    flex-direction: column;
    gap: var(--gap-xxl);
  }

  .pet-type-selection__header {
    text-align: center;
    max-width: 700px;
    margin: 0 auto;
  }

  .pet-type-selection__title {
    font-size: var(--font-size-xxl);
    font-weight: 700;
    color: var(--color-foreground);
    margin: 0 0 var(--gap-md) 0;
  }

  .pet-type-selection__subtitle {
    font-size: var(--font-size-lg);
    color: var(--color-foreground);
    opacity: 0.8;
    margin: 0;
  }

  .pet-type-selection__cards {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--gap-xl);
  }

  @media screen and (max-width: 749px) {
    .pet-type-selection__cards {
      grid-template-columns: 1fr;
    }
  }

  .pet-type-card {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    padding: var(--padding-xxl);
    border-radius: var(--style-border-radius-inputs);
    border: 2px solid var(--color-input-border);
    background-color: var(--color-input-background);
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
  }

  .pet-type-card:hover {
    border-color: var(--color-primary);
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  }

  .pet-type-card__image-wrapper {
    width: 100%;
    aspect-ratio: 1;
    border-radius: var(--style-border-radius-inputs);
    overflow: hidden;
    margin-bottom: var(--gap-md);
  }

  .pet-type-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .pet-type-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%);
  }

  .pet-type-card__icon {
    font-size: 6rem;
    line-height: 1;
  }

  .pet-type-card__title {
    font-weight: 600;
    color: var(--color-foreground);
    font-size: 1.3rem;
    margin: 0;
  }

  .pet-type-card__description {
    font-size: var(--font-size-base);
    color: var(--color-foreground);
    opacity: 0.8;
    margin: 0;
  }

  /* Stepper Form */
  .stepper-form {
    max-width: 700px;
    margin: 0 auto;
    padding-top: var(--padding-xl);
  }

  .stepper-progress {
    margin-bottom: var(--gap-xxl);
  }

  .stepper-progress__bar {
    width: 100%;
    height: 8px;
    background-color: var(--color-input-border);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: var(--gap-sm);
  }

  .stepper-progress__fill {
    height: 100%;
    background-color: var(--color-primary);
    transition: width 0.3s ease;
    width: 14.28%; /* 1/7 steps */
  }

  .stepper-progress__text {
    text-align: center;
    font-size: var(--font-size-sm);
    color: var(--color-foreground);
    opacity: 0.8;
    margin: 0;
  }

  .stepper-form__success,
  .stepper-form__error {
    align-items: center;
    gap: var(--gap-sm);
    padding: var(--padding-lg);
    border-radius: var(--style-border-radius-inputs);
    margin-bottom: var(--gap-lg);
  }

  .stepper-form__success[hidden],
  .stepper-form__error[hidden] {
    display: none !important;
  }

  .stepper-form__success:not([hidden]) {
    display: flex;
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
  }

  .stepper-form__error:not([hidden]) {
    display: flex;
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
  }

  .stepper-form__success svg,
  .stepper-form__error svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
  }

  /* Form Steps */
  .form-step {
    display: flex;
    flex-direction: column;
    gap: var(--gap-xxl);
    animation: fadeIn 0.3s ease;
   /*  min-height: 300px; */
    padding: var(--padding-lg) 0;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .form-step[hidden] {
    display: none;
  }

  .form-step__title {
    font-size: 16px;
    font-weight: 600;
    color: var(--color-foreground);
    
  }

  .form-step__help {
    font-size: 16px;
    color: var(--color-foreground);
    opacity: 0.8;
    padding-bottom: 10px;
  }

  .form-field__input {
    width: 100%;
    padding: var(--padding-lg) var(--padding-xl);
    border-radius: var(--style-border-radius-inputs);
    border: var(--style-border-width-inputs) solid var(--color-input-border);
    background-color: var(--color-input-background);
    color: var(--color-input-text);
    font-size: 16px;
  }

  .form-field__input:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: 2px;
  }

  .form-field__radio-group {
    display: grid;
    gap: var(--gap-lg);
    margin-top: var(--gap-md);
  }

  .form-field__radio-group--weight,
  .form-field__radio-group--boost {
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  }

  @media screen and (max-width: 749px) {
    .form-field__radio-group {
      grid-template-columns: 1fr;
    }
  }

  .radio-card,
  .checkbox-card {
    position: relative;
    cursor: pointer;
  }

  .radio-card input[type="radio"],
  .checkbox-card input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .radio-card__content,
  .checkbox-card__content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: var(--gap-sm);
    padding: var(--padding-xl);
    border-radius: var(--style-border-radius-inputs);
    border: 2px solid var(--color-input-border);
    background-color: var(--color-input-background);
    transition: all 0.2s ease;
    min-height: 100px;
  }

  .radio-card--weight .radio-card__content,
  .radio-card--boost .radio-card__content {
    min-height: 120px;
  }

  .radio-card input[type="radio"]:checked ~ .radio-card__content,
  .checkbox-card input[type="checkbox"]:checked ~ .checkbox-card__content {
    border-color: var(--color-primary);
    background-color: var(--color-primary);
    color: white;
  }

  .radio-card:hover .radio-card__content,
  .checkbox-card:hover .checkbox-card__content {
    border-color: var(--color-primary);
  }

  .radio-card__icon,
  .checkbox-card__icon {
    font-size: 2rem;
  }

  .radio-card__label,
  .checkbox-card__label {
    font-weight: 600;
    text-align: center;
  }

  .radio-card__title {
    font-weight: 600;
    font-size: var(--font-size-base);
    text-align: center;
  }

  .radio-card__subtitle {
    font-size: var(--font-size-sm);
    opacity: 0.8;
    text-align: center;
  }

  .form-field__checkbox-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: var(--gap-lg);
    margin-top: var(--gap-md);
  }

  @media screen and (max-width: 749px) {
    .form-field__checkbox-group {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  /* Review Summary */
  .review-summary {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    padding: var(--padding-xl);
    border-radius: var(--style-border-radius-inputs);
    background-color: var(--color-input-background);
    border: 1px solid var(--color-input-border);
  }

  .review-summary__item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding-bottom: var(--gap-md);
    border-bottom: 1px solid var(--color-input-border);
  }

  .review-summary__item:last-child {
    padding-bottom: 0;
    border-bottom: none;
  }

  .review-summary__label {
    font-weight: 600;
    color: var(--color-foreground);
    opacity: 0.8;
  }

  .review-summary__value {
    font-weight: 500;
    color: var(--color-foreground);
    text-align: right;
  }

  /* Navigation */
  .stepper-navigation {
    display: flex;
    gap: var(--gap-md);
    margin-top: var(--gap-xxl);
    padding-top: var(--padding-xl);
  }

  .stepper-navigation button {
    flex: 1;
    padding: var(--padding-lg) var(--padding-xl);
    font-size: 16px;
    font-weight: 600;
  }

  .stepper-navigation button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .stepper-navigation button[hidden] {
    display: none;
  }
{% endstylesheet %}
